<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã“ã“ã‚ã®ã‚³ãƒ³ãƒ‘ã‚¹</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@300;400;500&family=Mochiy+Pop+One&display=swap');
        :root {
            --bg-main: #FAF7F2;
            --bg-container: #FFFFFF;
            --bg-form-area: #FFFDF9;
            --text-primary: #5D4037;
            --text-secondary: #8D6E63;
            --accent-main: #FFCC80;
            --accent-gentle: #FFE0B2;
            --border-color: #E0D8CF;
            --font-body: 'Kiwi Maru', serif;
            --font-heading: 'Mochiy Pop One', sans-serif;
            /* æ„Ÿæƒ…ã®è‰² */
            --emotion-happy: #AED581;        /* ğŸ˜Š ã†ã‚Œã—ã„ */
            --emotion-calm: #B2DFDB;         /* ğŸ˜Œ ãŠã ã‚„ã‹ */
            --emotion-neutral: #E0E0E0;      /* ğŸ™‚ ãµã¤ã† */
            --emotion-sad: #B0BEC5;          /* ğŸ˜¢ ã‹ãªã—ã„ */
            --emotion-frustrated: #FFCCBC;  /* ğŸ˜  ã‚¤ãƒ©ã‚¤ãƒ© */
            --emotion-lonely: #A4B8BF;     /* ğŸ˜” ã•ã¿ã—ã„ (æ–°ã—ã„è‰²) */
            /* ä»–ã®æ„Ÿæƒ…è‰²ã‚‚å¿…è¦ã«å¿œã˜ã¦ã“ã“ã«è¿½åŠ  */
            --emotion-very-happy: #FFF176;
            --emotion-fun: #A5D6A7;
            --emotion-tired: #CFD8DC;
            --emotion-very-sad: #90A4AE;
            --emotion-anxious: #D1C4E9;
            --emotion-other: #D7CCC8;
        }
        body { font-family: var(--font-body); margin: 0; padding: 15px; background-color: var(--bg-main); color: var(--text-primary); line-height: 1.7; display: flex; flex-direction: column; align-items: center; min-height: 100vh; box-sizing: border-box; }
        .app-wrapper { width: 100%; max-width: 580px; }
        .container { background-color: var(--bg-container); padding: 20px; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.07); margin-bottom: 20px; border: 1px solid var(--border-color); }
        header { text-align: center; margin-bottom: 20px; }
        header h1 { font-family: var(--font-heading); font-size: 2em; margin-bottom: 5px; }
        header .subtitle { font-size: 0.9em; color: var(--text-secondary); }
        .section-title { font-family: var(--font-heading); color: var(--text-primary); margin-top:0; margin-bottom: 15px; font-size: 1.3em; text-align: center; padding-bottom: 5px; border-bottom: 1px dotted var(--accent-gentle); }
        
        .form-area { padding: 15px; background-color: var(--bg-form-area); border-radius: 10px; }
        .form-group { margin-bottom: 15px; }
        .form-group:last-child { margin-bottom: 0; }
        label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.85em; }
        
        .emotion-selector { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; }
        .emotion-button { background-color: #fff; border: 2px solid var(--border-color); color: var(--text-secondary); padding: 10px 5px; border-radius: 8px; cursor: pointer; font-size: 0.8em; transition: all 0.15s ease; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; min-height: 60px; }
        .emotion-button .emotion-icon { font-size: 1.5em; margin-bottom: 3px; }
        .emotion-button.selected { border-width: 2px; font-weight: bold; color: var(--text-primary); transform: scale(1.02); box-shadow: 0 1px 4px rgba(0,0,0,0.1); }
        
        textarea#diary-memo-input { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background-color: #fff; color: var(--text-primary); font-size: 0.9em; font-family: var(--font-body); min-height: 70px; resize: vertical; box-sizing: border-box; }
        textarea#diary-memo-input:focus { outline: none; border-color: var(--accent-main); box-shadow: 0 0 0 2px rgba(255, 204, 128, 0.3); }

        button[type="submit"] { display: block; width: 100%; margin-top: 15px; padding: 10px 15px; background-color: var(--accent-main); color: var(--text-primary); border: none; border-radius: 20px; cursor: pointer; font-size: 0.95em; font-weight: 700; font-family: var(--font-heading); transition: background-color 0.2s ease, transform 0.1s ease; }
        button[type="submit"]:hover { background-color: #FFA726; transform: translateY(-1px); }
        button[type="submit"]:active { transform: translateY(0px); }

        .diary-list { list-style: none; padding: 0; margin-top: 20px; }
        .diary-list li {
            background-color: #fff; padding: 12px 15px; margin-bottom: 10px;
            border-radius: 8px; border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            display: flex; align-items: center; gap: 10px;
        }
        .diary-list li .entry-emotion-icon-display { font-size: 1.6em; flex-shrink: 0; width: 30px; text-align: center; }
        .diary-list li .entry-text-content { flex-grow: 1; }
        .diary-list li .entry-memo-text { font-size: 0.9em; color: var(--text-primary); margin-bottom: 3px; white-space: pre-wrap; word-break: break-word; }
        .diary-list li .entry-date { font-size: 0.75em; color: var(--text-secondary); text-align: right; }
        .diary-list li .entry-actions { flex-shrink: 0; }
        .delete-button { 
            background-color: #ffebee; 
            border: 1px solid #ef9a9a; 
            color: #c62828; 
            padding: 4px 8px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 0.7em; 
            font-family: var(--font-body);
            transition: all 0.2s ease;
        }
        .delete-button:hover { 
            background-color: #ffcdd2; 
            border-color: #e57373; 
        }
        
        .message-box { padding: 8px 12px; border-radius: 6px; margin-bottom: 10px; text-align: center; font-size: 0.8em; border-width: 1px; border-style: solid; display:none;}
        .info-message { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .error-message { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .no-diary-message { text-align: center; color: var(--text-secondary); padding: 15px; background-color: #f9f9f9; border-radius: 8px; border: 1px dashed var(--border-color); }
        #error-log-display { color: red; white-space: pre-wrap; border: 1px solid red; padding: 10px; margin-top: 20px; background-color: #fff0f0; display: none; }
        .privacy-note { font-size: 0.8em; color: var(--text-secondary); text-align: center; margin-top: 20px; padding: 10px; background-color: #f0f0f0; border-radius: 6px; }

    </style>
</head>
<body>
    <div class="app-wrapper">
        <div class="container">
            <header>
                <h1>ã“ã“ã‚ã®ã‚³ãƒ³ãƒ‘ã‚¹</h1>
                <p class="subtitle">ä»Šæ—¥ã®ãã‚‚ã¡ã‚’ã€ã®ã“ãã†</p>
            </header>

            <div id="info-display" class="message-box info-message"></div>
            <div id="error-log-display" class="error-message"></div>

            <section class="form-section">
                <h2 class="section-title">ä»Šã®ã‚ãŸã—</h2>
                <div class="form-area">
                    <form id="diary-form">
                        <div class="form-group">
                            <label>ã©ã‚“ãªãã‚‚ã¡ï¼Ÿ (ã²ã¨ã¤ãˆã‚‰ã‚“ã§ã­)</label>
                            <div class="emotion-selector" id="emotion-selector-buttons">
                                <!-- JSã§æ„Ÿæƒ…ãƒœã‚¿ãƒ³ã‚’ç”Ÿæˆ -->
                            </div>
                            <input type="hidden" id="selected-emotion-value">
                        </div>
                        <div class="form-group">
                            <label for="diary-memo-input">ã²ã¨ã“ã¨ (æ€ã£ãŸã“ã¨ã€ã‚ã£ãŸã“ã¨)</label>
                            <textarea id="diary-memo-input" rows="3" placeholder="ã„ã¾ã€ã©ã‚“ãªæ„Ÿã˜ï¼Ÿ"></textarea>
                        </div>
                        <button type="submit">ã®ã“ã™</button>
                    </form>
                </div>
            </section>
        </div>

        <div class="container list-section">
            <h2 class="section-title">ã“ã‚Œã¾ã§ã®ã‚ãŸã—</h2>
            <ul id="diary-list-ul" class="diary-list"></ul>
        </div>
        
        <div class="privacy-note container">
            <p><strong>å®‰å¿ƒã—ã¦ã­ã€‚</strong>ã“ã“ã«æ›¸ã„ãŸã“ã¨ã¯ã€ã“ã®ç«¯æœ«ã®ä¸­ã«ã ã‘ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©
        window.onerror = function(message, source, lineno, colno, error) {
            const errorLog = document.getElementById('error-log-display');
            if (errorLog) {
                errorLog.textContent += `ãƒšãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼:\n${message}\nãƒ•ã‚¡ã‚¤ãƒ«: ${source}\nè¡Œ: ${lineno}, åˆ—: ${colno}\n\n`;
                errorLog.style.display = 'block';
            }
            console.error("ã‚­ãƒ£ãƒƒãƒã•ã‚Œãªã‹ã£ãŸã‚¨ãƒ©ãƒ¼:", message, "at", source, lineno, colno, error);
            return false;
        };

        try {
            document.addEventListener('DOMContentLoaded', () => {
                console.log("DOM Content Loaded. Final Stable Version Initializing...");

                const diaryForm = document.getElementById('diary-form');
                const emotionSelectorButtons = document.getElementById('emotion-selector-buttons');
                const selectedEmotionInput = document.getElementById('selected-emotion-value');
                const diaryMemoInput = document.getElementById('diary-memo-input');
                const diaryListUl = document.getElementById('diary-list-ul');
                const errorLogDisplay = document.getElementById('error-log-display');
                const infoDisplay = document.getElementById('info-display');

                let initError = false;
                if (!diaryForm || !emotionSelectorButtons || !selectedEmotionInput || !diaryMemoInput || !diaryListUl ) {
                    const missing = [];
                    if (!diaryForm) missing.push('diary-form');
                    if (!emotionSelectorButtons) missing.push('emotion-selector-buttons');
                    if (!selectedEmotionInput) missing.push('selected-emotion-value');
                    if (!diaryMemoInput) missing.push('diary-memo-input');
                    if (!diaryListUl) missing.push('diary-list-ul');
                    if (missing.length > 0) {
                        console.error(`å¿…é ˆDOMè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${missing.join(', ')}`);
                        if (errorLogDisplay) {
                            errorLogDisplay.textContent = `ãƒšãƒ¼ã‚¸éƒ¨å“ä¸è¶³: ${missing.join(', ')}`;
                            errorLogDisplay.style.display = 'block';
                        }
                        initError = true;
                    }
                }
                if (initError) return;
                console.log("ä¸»è¦DOMè¦ç´ å–å¾—å®Œäº†ã€‚");

                const LOCAL_STORAGE_KEY_DIARIES = 'kokoroCompassFinalStable_v1';
                let diaries = [];

                // æ„Ÿæƒ…ã®é¸æŠè‚¢ã«ã€Œå¯‚ã—ã„ãƒ»è™šç„¡ã€ã‚’è¿½åŠ 
                const emotions = [
                    { text: "ã¨ã£ã¦ã‚‚ãƒãƒƒãƒ”ãƒ¼ï¼", value: "ğŸ˜† ã¨ã£ã¦ã‚‚ãƒãƒƒãƒ”ãƒ¼ï¼", icon: "ğŸ˜†", colorVar: '--emotion-very-happy', selectedBg: '#FFF9C4' },
                    { text: "ã„ã„æ„Ÿã˜ãƒ»ã†ã‚Œã—ã„", value: "ğŸ˜Š ã„ã„æ„Ÿã˜ãƒ»ã†ã‚Œã—ã„", icon: "ğŸ˜Š", colorVar: '--emotion-happy',    selectedBg: '#DCEDC8' },
                    { text: "ãŸã®ã—ã„ï¼", value: "ğŸ˜„ ãŸã®ã—ã„ï¼", icon: "ğŸ˜„", colorVar: '--emotion-fun',      selectedBg: '#C8E6C9' },
                    { text: "ãŠã ã‚„ã‹ãƒ»ãƒ›ãƒƒã¨ã—ãŸ", value: "ğŸ˜Œ ãŠã ã‚„ã‹ãƒ»ãƒ›ãƒƒã¨ã—ãŸ", icon: "ğŸ˜Œ", colorVar: '--emotion-calm',     selectedBg: '#E0F2F1' },
                    { text: "ãªã‚“ã¨ãªããƒ»æ™®é€š", value: "ğŸ™‚ ãªã‚“ã¨ãªããƒ»æ™®é€š", icon: "ğŸ™‚", colorVar: '--emotion-neutral',  selectedBg: '#F5F5F5' },
                    { text: "ç–²ã‚ŒãŸãªâ€¦", value: "ğŸ˜• ç–²ã‚ŒãŸãªâ€¦", icon: "ğŸ˜•", colorVar: '--emotion-tired',    selectedBg: '#ECEFF1' },
                    { text: "ã¡ã‚‡ã£ã¨æ‚²ã—ã„", value: "ğŸ˜¢ ã¡ã‚‡ã£ã¨æ‚²ã—ã„", icon: "ğŸ˜¢", colorVar: '--emotion-sad',      selectedBg: '#E3F2FD' },
                    { text: "ã•ã¿ã—ã„ãƒ»ã‚€ãªã—ã„", value: "ğŸ˜” ã•ã¿ã—ã„ãƒ»ã‚€ãªã—ã„", icon: "ğŸ˜”", colorVar: '--emotion-lonely', selectedBg: 'rgba(164, 184, 191, 0.2)' }, // æ–°ã—ã„æ„Ÿæƒ…
                    { text: "ã™ã”ãã¤ã‚‰ã„", value: "ğŸ˜­ ã™ã”ãã¤ã‚‰ã„", icon: "ğŸ˜­", colorVar: '--emotion-very-sad', selectedBg: 'rgba(179, 157, 219, 0.2)' },
                    { text: "ä¸å®‰ãªãã‚‚ã¡", value: "ğŸ˜¥ ä¸å®‰ãªãã‚‚ã¡", icon: "ğŸ˜¥", colorVar: '--emotion-anxious',  selectedBg: 'rgba(225, 190, 231, 0.2)' },
                    { text: "ã‚¤ãƒ©ã‚¤ãƒ©ãƒ»ã‚‚ã‚„ã‚‚ã‚„", value: "ğŸ˜  ã‚¤ãƒ©ã‚¤ãƒ©ãƒ»ã‚‚ã‚„ã‚‚ã‚„", icon: "ğŸ˜ ", colorVar: '--emotion-irritable',selectedBg: 'rgba(255, 204, 188, 0.2)' },
                    { text: "ã‚ˆãã‚ã‹ã‚‰ãªã„", value: "ğŸ¤” ã‚ˆãã‚ã‹ã‚‰ãªã„", icon: "ğŸ¤”", colorVar: '--emotion-other',    selectedBg: 'rgba(215, 204, 200, 0.2)' }
                ];
                const emotionColorMap = emotions.reduce((map, emotion) => {
                    map[emotion.value] = `var(${emotion.colorVar})`;
                    return map;
                }, {});

                function sanitizeHTML(str) {
                    if (typeof str !== 'string') return '';
                    const temp = document.createElement('div');
                    temp.textContent = str;
                    return temp.innerHTML;
                }

                function displayUserMessage(elementId, message, isError = false) {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = message;
                        element.className = `message-box ${isError ? 'error-message' : 'info-message'}`;
                        element.style.display = 'block';
                        setTimeout(() => { element.style.display = 'none'; }, 3000);
                    }
                }
                function clearMessages() {
                    if (infoDisplay) infoDisplay.style.display = 'none';
                }

                function renderEmotionButtons() {
                    if (!emotionSelectorButtons || !selectedEmotionInput) return;
                    emotionSelectorButtons.innerHTML = '';
                    emotions.forEach(emotion => {
                        const button = document.createElement('button');
                        button.type = 'button'; button.classList.add('emotion-button');
                        button.dataset.emotionValue = emotion.value;
                        button.innerHTML = `<span class="emotion-icon">${emotion.icon}</span>${emotion.text}`;
                        
                        button.addEventListener('click', () => {
                            document.querySelectorAll('.emotion-button').forEach(btn => {
                                btn.classList.remove('selected');
                                btn.style.borderColor = 'var(--border-color)';
                                btn.style.backgroundColor = '#fff';
                            });
                            button.classList.add('selected');
                            button.style.borderColor = `var(${emotion.colorVar})`;
                            button.style.backgroundColor = emotion.selectedBg;
                            selectedEmotionInput.value = emotion.value;
                        });
                        emotionSelectorButtons.appendChild(button);
                    });
                }
                
                function loadDiariesFromStorage() {
                    console.log("loadDiariesFromStorage: èª­ã¿è¾¼ã¿é–‹å§‹");
                    try {
                        const storedDiaries = localStorage.getItem(LOCAL_STORAGE_KEY_DIARIES);
                        diaries = storedDiaries ? JSON.parse(storedDiaries) : [];
                        console.log("æ—¥è¨˜ã‚’localStorageã‹ã‚‰ãƒ­ãƒ¼ãƒ‰æˆåŠŸ:", diaries.length, "ä»¶");
                    } catch (e) {
                        console.error("localStorageèª­ã¿è¾¼ã¿/ãƒ‘ãƒ¼ã‚¹å¤±æ•—:", e);
                        diaries = [];
                        displayUserMessage('error-log-display', "è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã€‚", true);
                    }
                }

                function saveDiariesToStorage() {
                    console.log("saveDiariesToStorage: ä¿å­˜é–‹å§‹, diaries:", JSON.parse(JSON.stringify(diaries)));
                    try {
                        localStorage.setItem(LOCAL_STORAGE_KEY_DIARIES, JSON.stringify(diaries));
                        console.log("æ—¥è¨˜ã‚’localStorageã«ä¿å­˜æˆåŠŸ:", diaries.length, "ä»¶");
                    } catch (e) {
                        console.error("localStorageä¿å­˜å¤±æ•—:", e);
                        displayUserMessage('error-log-display', "è¨˜éŒ²ã®ä¿å­˜ã«å¤±æ•—ã€‚", true);
                    }
                }

                function deleteDiary(diaryId) {
                    console.log("deleteDiary: å‰Šé™¤é–‹å§‹, ID:", diaryId);
                    const index = diaries.findIndex(diary => diary.id === diaryId);
                    if (index !== -1) {
                        const deletedDiary = diaries.splice(index, 1)[0];
                        saveDiariesToStorage();
                        renderDiaryList();
                        displayUserMessage('info-display', "ãã‚ãã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
                        console.log("æ—¥è¨˜å‰Šé™¤å®Œäº†:", deletedDiary);
                    } else {
                        console.error("å‰Šé™¤å¯¾è±¡ã®æ—¥è¨˜ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ID:", diaryId);
                        displayUserMessage('error-log-display', "å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", true);
                    }
                }

                function renderDiaryList() {
                    if (!diaryListUl) { console.error("renderDiaryList: diaryListUl is null!"); return; }
                    diaryListUl.innerHTML = '';
                    console.log("renderDiaryList: æç”»é–‹å§‹ã€‚ç¾åœ¨ã®diariesé…åˆ—ã®ä»¶æ•°:", diaries.length);

                    if (diaries.length === 0) {
                        diaryListUl.innerHTML = '<li class="no-diary-message">ã¾ã ãã‚ããŒã‚ã‚Šã¾ã›ã‚“ã€‚</li>';
                        return;
                    }
                    const sortedDiaries = [...diaries].sort((a, b) => new Date(b.date) - new Date(a.date));

                    sortedDiaries.forEach(diary => {
                        const li = document.createElement('li');
                        const emotionData = emotions.find(e => e.value === diary.emotion);
                        const emotionColor = emotionData ? `var(${emotionData.colorVar})` : 'var(--emotion-neutral)';
                        const emotionIcon = emotionData ? emotionData.icon : "â”";
                        const emotionText = emotionData ? emotionData.text : (diary.emotion || 'ä¸æ˜ãªæ„Ÿæƒ…');

                        const formattedDate = new Date(diary.date).toLocaleString('ja-JP', { month: 'short', day: 'numeric', hour:'2-digit', minute:'2-digit' });
                        
                        li.style.borderLeftColor = emotionColor;

                        const emotionIconDiv = document.createElement('div');
                        emotionIconDiv.classList.add('entry-emotion-icon-display');
                        emotionIconDiv.innerHTML = emotionIcon;

                        const textContentDiv = document.createElement('div');
                        textContentDiv.classList.add('entry-text-content');
                        textContentDiv.innerHTML = `
                            <p class="entry-memo-text">${sanitizeHTML(diary.memo) || "(ã²ã¨ã“ã¨ãªã—)"}</p>
                            <p class="entry-date">${formattedDate}</p>
                        `;

                        const actionsDiv = document.createElement('div');
                        actionsDiv.classList.add('entry-actions');
                        const deleteButton = document.createElement('button');
                        deleteButton.classList.add('delete-button');
                        deleteButton.textContent = 'å‰Šé™¤';
                        deleteButton.addEventListener('click', () => {
                            if (confirm('ã“ã®ãã‚ãã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                                deleteDiary(diary.id);
                            }
                        });
                        actionsDiv.appendChild(deleteButton);

                        li.appendChild(emotionIconDiv);
                        li.appendChild(textContentDiv);
                        li.appendChild(actionsDiv);

                        diaryListUl.appendChild(li);
                    });
                    console.log("æ—¥è¨˜ä¸€è¦§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†ã€‚");
                }
                
                if (diaryForm) {
                    diaryForm.addEventListener('submit', function(event) {
                        event.preventDefault();
                        clearMessages();
                        console.log("ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†é–‹å§‹");

                        const emotion = selectedEmotionInput.value;
                        const memo = diaryMemoInput.value.trim();

                        if (!emotion) {
                            displayUserMessage('error-log-display', "ãã‚‚ã¡ã‚’é¸ã‚“ã§ãã ã•ã„ã­ã€‚", true);
                            return;
                        }

                        const newEntry = {
                            id: Date.now().toString(),
                            emotion: emotion,
                            memo: memo,
                            date: new Date().toISOString()
                            // ä»–ã®æ©Ÿèƒ½ã®ãƒ‡ãƒ¼ã‚¿ã¯å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã§
                        };

                        diaries.unshift(newEntry);
                        saveDiariesToStorage();    
                        renderDiaryList();         
                        
                        diaryForm.reset();
                        document.querySelectorAll('.emotion-button').forEach(btn => {
                            btn.classList.remove('selected');
                            btn.style.borderColor = 'var(--border-color)';
                            btn.style.backgroundColor = '#fff';
                        });
                        if(selectedEmotionInput) selectedEmotionInput.value = '';
                        
                        displayUserMessage('info-display', "ãã‚‚ã¡ã‚’ã®ã“ã—ã¾ã—ãŸã€‚");
                    });
                } else {
                    console.error("æ—¥è¨˜ãƒ•ã‚©ãƒ¼ãƒ (#diary-form)ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
                }

                // --- åˆæœŸåŒ– ---
                try {
                    console.log("åˆæœŸåŒ–å‡¦ç† (æœ€çµ‚èª¿æ•´ç‰ˆ) é–‹å§‹");
                    renderEmotionButtons();
                    loadDiariesFromStorage();
                    renderDiaryList();
                    console.log("åˆæœŸåŒ–å‡¦ç† (æœ€çµ‚èª¿æ•´ç‰ˆ) å®Œäº†");
                } catch (e) {
                    console.error("åˆæœŸåŒ–ä¸­ã«ã‚¨ãƒ©ãƒ¼:", e);
                    if(errorLogDisplay) displayUserMessage('error-log-display', "ãƒšãƒ¼ã‚¸ã®æº–å‚™ä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚", true);
                }
            });
        } catch (e) {
            console.error("DOMContentLoadedã‚ˆã‚Šå‰ã®ã‚¨ãƒ©ãƒ¼:", e);
            alert("ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ã®åˆæœŸæ®µéšã§é‡å¤§ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        }
    </script>
</body>
</html>
